{% extends 'base.html' %}

{% block content %}
  <h1>ë„ì„œ ìƒì„¸ í˜ì´ì§€</h1>

  {% if book.cover %}
    <div style="width: 300px; margin-bottom:1rem;">
      <img src="{{ book.cover }}" alt="" class="w-100">
    </div>
  {% endif %}
  
  <div class="d-flex flex-row justify-content-between align-items-between">
    <h2>{{ book.title }}</h2>
    <small style="color: #888;">
      {{ book.category }}
    </small>  
  </div>
  <p>{{ book.description }}</p>
  <hr>

  <!-- ì‘í’ˆ ì •ë³´ ì„¹ì…˜ -->
  <div style="display: flex; justify-content: center; align-items: center; gap: 2rem;">
    <!-- ì‘í’ˆ í…ìŠ¤íŠ¸ ì •ë³´ ì˜ì—­ -->
    <div style="flex: 1;">
      <h6>íšŒì› ë¦¬ë·° í‰ì  : {{ book.customer_review_rank|floatformat:"0" }} / 10</h6>
      <h6>ì¶œíŒì‚¬ : {{ book.publisher }}</h6>
      <h6>ì¶œíŒì¼ : {{ book.pub_date }}</h6>
      <h6>ISBN : {{ book.isbn }}</h6>
    </div>
  </div>

  <!-- ì‘ê°€ ì •ë³´ ì„¹ì…˜ (í”„ë¡œí•„ + ì‘ê°€ í…ìŠ¤íŠ¸ ì •ë³´) -->
  <hr>
  <div style="display: flex; justify-content: center; align-items: center; gap: 2rem;">
    <!-- í”„ë¡œí•„ ì´ë¯¸ì§€ ì˜ì—­ -->
    {% if book.author_photo %}
      <div style="width: 120px; height: 120px;">
        <img 
          src="{{ book.author_photo }}" 
          alt="{{ book.author }}" 
          style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;"
        >
      </div>
    {% endif %}
    
    <!-- ì‘ê°€ í…ìŠ¤íŠ¸ ì •ë³´ ì˜ì—­ -->
    <div style="flex: 1;">
      <h3>{{ book.author }}</h3>
      <p>{{ book.author_info }}</p>
    </div>
  </div>
  <div>
    <small style="color: #888;">
      â€» ë„ì„œ DB ì œê³µ : ì•Œë¼ë”˜ ì¸í„°ë„·ì„œì (www.aladin.co.kr)
    </small>
  </div>

  <!-- Thread ì˜ì—­ -->
  <hr>
  <div class="d-flex flex-row justify-content-between">
    <h2>Thread</h2>
    {% if user.is_authenticated %}
      <a href="{% url 'books:thread_create' book.pk %}">ì“°ë ˆë“œ ì‘ì„±</a>
    {% endif %}
  </div>

  <div>
    {% for thread in book.thread_set.all %}
      <div class="d-flex flex-row justify-content-between">
        <a
          href="{% url 'books:thread_detail' book.pk thread.pk %}"
          class="d-flex justify-content-between align-items-center"
        >
          <div class="thread-info">
            <span class="fw-bold">{{ thread.title }}</span>
            <span class="separator">|</span>
            <span>{{ thread.user.username }}</span>
          </div>
        </a>
        <div><i class="bi bi-heart-fill me-1"></i> {{ thread.likes.count }}</div>
      </div>
    {% empty %}
      <p>ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
    {% endfor %}
  </div>

  <hr>

  <div>
    <a href="{% url 'books:index' %}" class="btn btn-secondary mb-5">BACK</a>
  </div>

  <hr>
<h4>ğŸ“š ìœ ì‚¬í•œ ë„ì„œ ì¶”ì²œ</h4>
<div class="row row-cols-1 row-cols-md-3 g-4 mt-2">
  {% for rec_book in recommended_books %}
    <div class="col">
      <div class="card h-100">
        {% if rec_book.cover_img %}
          <img src="{{ rec_book.cover_img.url }}" class="card-img-top" alt="{{ rec_book.title }}">
        {% endif %}
        <div class="card-body">
          <h5 class="card-title">{{ rec_book.title }}</h5>
          <p class="card-text text-muted">{{ rec_book.description|truncatewords:15 }}</p>
          <a href="{% url 'books:detail' rec_book.pk %}" class="btn btn-sm btn-outline-primary">ìì„¸íˆ ë³´ê¸°</a>
        </div>
      </div>
    </div>
  {% empty %}
    <p>ìœ ì‚¬í•œ ë„ì„œê°€ ì—†ìŠµë‹ˆë‹¤.</p>
  {% endfor %}
</div>
{% endblock content %}
